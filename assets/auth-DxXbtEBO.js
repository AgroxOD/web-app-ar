function c(){return localStorage.getItem("jwt")}function l(t){try{const[,e]=t.split(".");if(!e)return{};const o=atob(e.replace(/-/g,"+").replace(/_/g,"/"));return JSON.parse(o)}catch{return{}}}function f(t){t&&localStorage.setItem("jwt",t)}function g(){const t=localStorage.getItem("role");if(t)return t;const e=c();if(e){const{role:o}=l(e);if(o)return localStorage.setItem("role",o),o}return"user"}function a(t){t&&localStorage.setItem("role",t)}function d(t,e){if(f(t),e)a(e);else{const{role:o}=l(t);o&&a(o)}}function m(){localStorage.removeItem("jwt"),localStorage.removeItem("role")}function S(){return!!c()}let r="".trim();r||(console.warn("VITE_API_BASE_URL is empty; falling back to location.origin"),r=typeof location<"u"?location.origin:"");async function s(t,e,o){const u=r+t,n=await fetch(u,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),i=await n.json().catch(()=>({}));if(!n.ok)throw new Error(i.error||`${o}: ${n.status}`);return i}function h(t,e){return s("/auth/login",{email:t,password:e},"Login failed")}function p(t,e,o){return s("/auth/register",{username:t,email:e,password:o},"Register failed")}export{l as decodeJwt,g as getRole,c as getToken,S as isAuthenticated,h as login,m as logout,p as register,d as setAuth,a as setRole,f as setToken};
