import"./style-DBLwl-Ec.js";import{login as p,setToken as g,register as f,logout as E,isAuthenticated as y}from"./auth-BvfLdpt4.js";import{loadModels as I,updateModel as h,deleteModel as v}from"./models-VtKfwujZ.js";const B="";function a(n,t=!1){const e=document.getElementById("api-message");e.style.color=t?"red":"green",e.textContent=n,e.classList.remove("hidden")}function m(){document.getElementById("api-message").classList.add("hidden")}async function i(){const n=document.getElementById("model-list");n.innerHTML="";try{const t=await I();m(),t.forEach(e=>{const l=e._id||e.id||e.url,o=document.createElement("li"),s=document.createElement("span");s.textContent=`${e.name} (${e.url}) marker: ${e.markerIndex}`,o.appendChild(s);const d=document.createElement("button");d.textContent="Edit",d.className="button button-secondary";const c=document.createElement("button");c.textContent="Delete",c.className="button",o.append(" ",d," ",c),d.addEventListener("click",()=>w(o,l,e,d)),c.addEventListener("click",()=>b(l)),n.appendChild(o)})}catch{a("Failed to load models",!0)}}async function b(n){if(confirm("Delete this model?"))try{await v(n),a("Model deleted"),await i()}catch{a("Delete failed",!0)}}function w(n,t,e,l){const o=document.createElement("form");o.className="inline-form",o.innerHTML=`
          <input class="text-input" name="name" value="${e.name}" required />
          <input class="text-input" name="markerIndex" type="number" value="${e.markerIndex}" required />
          <button class="button button-primary" type="submit">Save</button>
          <button class="button" type="button">Cancel</button>
        `,o.querySelector('button[type="button"]').addEventListener("click",()=>{o.remove(),l.disabled=!1}),o.addEventListener("submit",async d=>{d.preventDefault();try{await h(t,{name:o.name.value,markerIndex:parseInt(o.markerIndex.value,10)||0}),a("Model updated"),await i()}catch{a("Update failed",!0)}}),l.disabled=!0,n.appendChild(o)}let u=!1;function r(){const n=y(),t=document.getElementById("login-form"),e=document.getElementById("register-form");n?(t.style.display="none",e.style.display="none"):u?(t.style.display="none",e.style.display="flex"):(t.style.display="flex",e.style.display="none"),document.getElementById("logout").classList.toggle("hidden",!n),document.getElementById("upload-form").classList.toggle("hidden",!n);const l=document.getElementById("upload-message");n?(l.style.display="none",l.textContent=""):(l.textContent="Login required to upload models",l.style.display="block")}document.getElementById("login-form").addEventListener("submit",async n=>{n.preventDefault();try{const{jwt:t}=await p(document.getElementById("login-email").value,document.getElementById("login-password").value);g(t),r(),await i(),m()}catch(t){a(t.message,!0)}});document.getElementById("register-form").addEventListener("submit",async n=>{n.preventDefault();try{const{jwt:t}=await f(document.getElementById("reg-username").value,document.getElementById("reg-email").value,document.getElementById("reg-password").value);g(t),r(),await i(),m()}catch(t){a(t.message,!0)}});document.getElementById("show-register").addEventListener("click",()=>{u=!0,r()});document.getElementById("show-login").addEventListener("click",()=>{u=!1,r()});document.getElementById("logout").addEventListener("click",()=>{E(),r(),document.getElementById("model-list").innerHTML="",m()});document.getElementById("upload-form").addEventListener("submit",async n=>{n.preventDefault();const t=document.getElementById("file"),e=t.files[0];if(e&&e.size>10*1024*1024){a("File too large",!0);return}const l=new FormData;e&&l.append("model",e);try{const o={},s=localStorage.getItem("jwt");if(s&&(o.Authorization=`Bearer ${s}`),!(await fetch(`${B}/upload`,{method:"POST",headers:o,body:l})).ok)throw new Error("upload failed");t.value="",await i(),a("Upload successful")}catch{a("Upload failed",!0)}});r();y()&&i();
